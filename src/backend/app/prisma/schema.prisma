generator client {
    provider             = "prisma-client-py"
    interface            = "asyncio"
    recursive_type_depth = 5
}

datasource db {
    provider = "postgresql"//"sqlite" 
    url      = env("DATABASE_URL")  //file:./db.db // 
}

enum Role {
    NURSE
    ASSISTANT
    ADMIN
}

enum Status {
    PENDING
    ACCEPTED
    REJECTED
    DONE
    CANCELED
}

model User {
    id       String  @id @default(uuid())
    name     String
    email    String
    password String
    role              Role[]     @default([NURSE])
    //role     String?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    feedback_sent     Feedback[] @relation("feedbacks_sent")
    feedback_received Feedback[] @relation("feedbacks_received")
    order_sent        Order[]    @relation("order_sent")
    order_received    Order[]    @relation("order_received")
    order_canceled    Order[]    @relation("order_canceled")
}

model Feedback {
    id           Int     @id @unique @default(autoincrement())
    message_user String?
    message_app  String?
    rate_user    Int
    rate_app     Int?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    Order           Order[]
    sender_user     User    @relation("feedbacks_sent", fields: [sender_userId], references: [id])
    sender_userId   String
    receiver_user   User    @relation("feedbacks_received", fields: [receiver_userId], references: [id])
    receiver_userId String
}

model Order {
    id           Int         @id @unique @default(autoincrement())
    medication   Medications @relation(fields: [medicationId], references: [id])
    medicationId Int
    status       Status[]     @default([PENDING])

    sender_user     User   @relation("order_sent", fields: [sender_userId], references: [id])
    sender_userId   String
    receiver_user   User?  @relation("order_received", fields: [receiver_userId], references: [id])
    receiver_userId String

    feedback   Feedback? @relation(fields: [feedbackId], references: [id])
    feedbackId Int?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    canceledAt      DateTime?
    canceledBy      User?     @relation("order_canceled", fields: [canceled_userId], references: [id])
    canceled_userId String?
    canceled_reason String?
    canceled        Boolean   @default(false)

    deleted Boolean @default(false)
}

model Medications {
    id          Int     @id @unique @default(autoincrement())
    area        String?
    description String?
    lot         Int
    medClass    String
    Orders      Order[]
}

model Logs {
    id Int @id @unique @default(autoincrement())
}
